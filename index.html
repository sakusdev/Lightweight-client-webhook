<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Discord Webhook Embed å®šæœŸé€ä¿¡</title>
<style>
  body { font-family: sans-serif; max-width: 500px; margin: auto; padding: 2em; }
  label { display: block; margin-top: 12px; }
  input, textarea, button { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; font-family: monospace; }
  button { cursor: pointer; }
  #log { margin-top: 15px; background: #f3f3f3; height: 140px; overflow-y: auto; padding: 10px; white-space: pre-wrap; font-size: 0.9em; border: 1px solid #ccc; }
  .btn-group { display: flex; gap: 10px; margin-top: 12px; }
  .btn-group button { flex: 1; }
</style>
</head>
<body>

<h2>ğŸ“¨ Discord Webhook Embed å®šæœŸé€ä¿¡</h2>

<label>Webhook URLï¼ˆè¤‡æ•°è¡Œå¯ãƒ»1è¡Œã«1ã¤ï¼‰:</label>
<textarea id="webhooks" rows="4" placeholder="https://discord.com/api/webhooks/xxxx/yyyy"></textarea>

<label>Embedã‚¿ã‚¤ãƒˆãƒ«:</label>
<input id="embedTitle" type="text" placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›" />

<label>Embedèª¬æ˜æ–‡:</label>
<textarea id="embedDesc" rows="3" placeholder="èª¬æ˜æ–‡ã‚’å…¥åŠ›"></textarea>

<label>é€ä¿¡é–“éš”ï¼ˆç§’ï¼‰:</label>
<input id="intervalSec" type="number" min="1" value="60" />

<div class="btn-group">
  <button id="startBtn">å®šæœŸé€ä¿¡é–‹å§‹</button>
  <button id="stopBtn" disabled>å®šæœŸé€ä¿¡åœæ­¢</button>
</div>

<button id="sendOnceBtn" style="margin-top: 15px;">ä¸€åº¦ã ã‘é€ä¿¡</button>

<div id="log"></div>

<script>
const webhooks = document.getElementById('webhooks');
const embedTitle = document.getElementById('embedTitle');
const embedDesc = document.getElementById('embedDesc');
const intervalSec = document.getElementById('intervalSec');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const sendOnceBtn = document.getElementById('sendOnceBtn');
const logDiv = document.getElementById('log');

let timerId = null;

function log(msg) {
  const time = new Date().toLocaleTimeString();
  logDiv.textContent += `[${time}] ${msg}\n`;
  logDiv.scrollTop = logDiv.scrollHeight;
}

async function sendEmbed() {
  const urls = webhooks.value.split('\n').map(s => s.trim()).filter(s => s);
  const title = embedTitle.value.trim();
  const description = embedDesc.value.trim();

  if (urls.length === 0) {
    alert('Webhook URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return false;
  }
  if (!title && !description) {
    alert('ã‚¿ã‚¤ãƒˆãƒ«ã‹èª¬æ˜æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return false;
  }

  const payload = {
    embeds: [
      {
        title: title || undefined,
        description: description || undefined,
        color: 0x0099ff
      }
    ]
  };

  log(`é€ä¿¡é–‹å§‹: ${urls.length} ä»¶ã®Webhook`);

  await Promise.all(urls.map(async (url, i) => {
    try {
      const res = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (res.ok) {
        log(`[æˆåŠŸ] (${i + 1}) ${url}`);
      } else {
        log(`[å¤±æ•—] (${i + 1}) ${url} - ${res.status} ${res.statusText}`);
      }
    } catch (e) {
      log(`[ã‚¨ãƒ©ãƒ¼] (${i + 1}) ${url} - ${e.message}`);
    }
  }));

  log('é€ä¿¡å®Œäº†');
  return true;
}

startBtn.onclick = () => {
  if (timerId !== null) {
    alert('ã™ã§ã«å®šæœŸé€ä¿¡ä¸­ã§ã™');
    return;
  }
  const interval = parseInt(intervalSec.value, 10);
  if (isNaN(interval) || interval < 1) {
    alert('é€ä¿¡é–“éš”ã¯1ç§’ä»¥ä¸Šã®æ•°å­—ã§æŒ‡å®šã—ã¦ãã ã•ã„');
    return;
  }
  sendEmbed();
  timerId = setInterval(sendEmbed, interval * 1000);
  log(`å®šæœŸé€ä¿¡ã‚’é–‹å§‹ã—ã¾ã—ãŸï¼ˆ${interval}ç§’æ¯ï¼‰`);
  startBtn.disabled = true;
  stopBtn.disabled = false;
  sendOnceBtn.disabled = true;
};

stopBtn.onclick = () => {
  if (timerId === null) {
    alert('å®šæœŸé€ä¿¡ã¯é–‹å§‹ã•ã‚Œã¦ã„ã¾ã›ã‚“');
    return;
  }
  clearInterval(timerId);
  timerId = null;
  log('å®šæœŸé€ä¿¡ã‚’åœæ­¢ã—ã¾ã—ãŸ');
  startBtn.disabled = false;
  stopBtn.disabled = true;
  sendOnceBtn.disabled = false;
};

sendOnceBtn.onclick = () => {
  sendEmbed();
};
</script>

</body>
</html>
