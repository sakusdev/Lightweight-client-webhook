<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Discord Webhook 複数同時送信ツール</title>
  <style>
    body { font-family: sans-serif; padding: 2em; max-width: 600px; margin: auto; }
    input, textarea, select, button { width: 100%; margin-top: 10px; padding: 8px; box-sizing: border-box; }
    .row { display: flex; gap: 10px; }
    .row > * { flex: 1; }
    label { margin-top: 15px; display: block; }
  </style>
</head>
<body>
  <h2>📨 Discord Webhook 複数同時送信ツール</h2>

  <label>Webhook URL選択:</label>
  <select id="webhookSelect"></select>
  <input id="webhookUrl" type="text" placeholder="https://discord.com/api/webhooks/..." />

  <label>
    <input type="checkbox" id="sendAll" />
    全てのWebhookに送信する
  </label>

  <label>ユーザー名:</label>
  <input id="username" type="text" placeholder="Bot名" />

  <label>メッセージ内容:</label>
  <textarea id="content" rows="3" placeholder="ここにメッセージを入力"></textarea>

  <label>Embed タイトル:</label>
  <input id="embedTitle" type="text" placeholder="オプション（埋め込みタイトル）" />

  <label>Embed 説明:</label>
  <textarea id="embedDesc" rows="2" placeholder="オプション（説明文）"></textarea>

  <label>ループ間隔（秒）:</label>
  <input id="interval" type="number" min="1" value="10" />

  <div class="row">
    <button id="sendOnce">📤 一度だけ送信</button>
    <button id="toggleLoop">🔁 ループ開始</button>
  </div>

  <script>
    let intervalId = null;
    const select = document.getElementById('webhookSelect');
    const urlInput = document.getElementById('webhookUrl');

    // Webhook一覧（ここに必要に応じて追加してください）
    const webhooks = {
      "テスト1": "https://discord.com/api/webhooks/XXXX/AAA",
      "テスト2": "https://discord.com/api/webhooks/YYYY/BBB"
    };

    // セレクトボックスにWebhookを追加
    for (const name in webhooks) {
      const opt = document.createElement('option');
      opt.value = webhooks[name];
      opt.textContent = name;
      select.appendChild(opt);
    }

    // 選択変更でURL欄を更新
    select.addEventListener('change', () => {
      urlInput.value = select.value;
    });
    select.dispatchEvent(new Event('change'));

    function sendWebhook() {
      const content = document.getElementById('content').value;
      const username = document.getElementById('username').value;
      const embedTitle = document.getElementById('embedTitle').value;
      const embedDesc = document.getElementById('embedDesc').value;
      const sendAll = document.getElementById('sendAll').checked;

      if (!content && !embedTitle && !embedDesc) {
        alert('メッセージかEmbedのどちらかを入力してください');
        return;
      }

      const payload = {
        username,
        content,
        embeds: []
      };

      if (embedTitle || embedDesc) {
        payload.embeds.push({
          title: embedTitle || undefined,
          description: embedDesc || undefined,
          color: 0x00bfff
        });
      }

      const urls = sendAll ? Object.values(webhooks) : [urlInput.value];

      urls.forEach(url => {
        if (!url) return;
        fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        })
          .then(res => {
            if (!res.ok) alert(`送信失敗: ${url} - ${res.statusText}`);
          })
          .catch(err => alert(`エラー: ${url} - ${err}`));
      });
    }

    document.getElementById('sendOnce').onclick = sendWebhook;

    document.getElementById('toggleLoop').onclick = function () {
      if (intervalId) {
        clearInterval(intervalId);
        intervalId = null;
        this.textContent = '🔁 ループ開始';
      } else {
        const intervalSec = parseInt(document.getElementById('interval').value);
        if (isNaN(intervalSec) || intervalSec < 1) {
          alert('有効な秒数を入力してください');
          return;
        }
        intervalId = setInterval(sendWebhook, intervalSec * 1000);
        this.textContent = '⏹️ ループ停止';
      }
    };
  </script>
</body>
</html>
