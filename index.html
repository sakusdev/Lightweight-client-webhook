<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>Discord Webhook å®šæœŸé€ä¿¡ + Embedå¯¾å¿œ</title>
<style>
  body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 2em; }
  textarea, input, button { width: 100%; margin-top: 10px; padding: 8px; box-sizing: border-box; font-family: monospace; }
  label { margin-top: 15px; display: block; }
  #log { white-space: pre-wrap; background: #eee; padding: 10px; margin-top: 15px; height: 150px; overflow-y: auto; font-size: 0.9em; }
</style>
</head>
<body>
<h2>ğŸ“¨ Discord Webhook </h2>

<label>Webhook URLãƒªã‚¹ãƒˆï¼ˆ1è¡Œã«1ã¤ãšã¤ï¼‰:</label>
<textarea id="webhookList" rows="5" placeholder="https://discord.com/api/webhooks/xxxx/yyyy\nhttps://discord.com/api/webhooks/aaaa/bbbb"></textarea>

<label>ãƒ¦ãƒ¼ã‚¶ãƒ¼å:</label>
<input id="username" type="text" placeholder="Botå" />

<label>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ï¼ˆãƒ†ã‚­ã‚¹ãƒˆï¼‰:</label>
<textarea id="content" rows="3" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›"></textarea>

<label>Embed JSONï¼ˆä¾‹: [{ "title": "ã‚¿ã‚¤ãƒˆãƒ«", "description": "èª¬æ˜" }])</label>
<textarea id="embedJson" rows="5" placeholder='[{"title":"ã‚¿ã‚¤ãƒˆãƒ«","description":"èª¬æ˜"}]'></textarea>

<label>é€ä¿¡é–“éš”ï¼ˆç§’ï¼‰:</label>
<input id="intervalSec" type="number" min="1" value="60" />

<div style="display:flex; gap: 10px; margin-top: 15px;">
  <button id="startBtn" style="flex:1;">å®šæœŸé€ä¿¡é–‹å§‹</button>
  <button id="stopBtn" style="flex:1;" disabled>å®šæœŸé€ä¿¡åœæ­¢</button>
</div>

<button id="sendOnceBtn" style="margin-top: 10px;">ä¸€åº¦ã ã‘é€ä¿¡</button>

<div id="log"></div>

<script>
const webhookList = document.getElementById('webhookList');
const usernameInput = document.getElementById('username');
const contentInput = document.getElementById('content');
const embedJsonInput = document.getElementById('embedJson');
const intervalInput = document.getElementById('intervalSec');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const sendOnceBtn = document.getElementById('sendOnceBtn');
const logDiv = document.getElementById('log');

let timerId = null;

function log(msg) {
  const time = new Date().toLocaleTimeString();
  logDiv.textContent += `[${time}] ${msg}\n`;
  logDiv.scrollTop = logDiv.scrollHeight;
}

async function sendMessages() {
  const urls = webhookList.value.split('\n').map(s => s.trim()).filter(s => s);
  const username = usernameInput.value.trim() || undefined;
  const content = contentInput.value.trim();
  const embedJsonRaw = embedJsonInput.value.trim();

  if (urls.length === 0) {
    alert('Webhook URLã‚’1ã¤ä»¥ä¸Šå…¥åŠ›ã—ã¦ãã ã•ã„');
    return false;
  }
  if (!content && !embedJsonRaw) {
    alert('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ã¾ãŸã¯Embed JSONã®ã©ã¡ã‚‰ã‹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return false;
  }

  let embeds = undefined;
  if (embedJsonRaw) {
    try {
      embeds = JSON.parse(embedJsonRaw);
      if (!Array.isArray(embeds)) {
        alert('Embed JSONã¯é…åˆ—ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™');
        return false;
      }
    } catch(e) {
      alert('Embed JSONã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: ' + e.message);
      return false;
    }
  }

  const payload = {};
  if (content) payload.content = content;
  if (username) payload.username = username;
  if (embeds) payload.embeds = embeds;

  log(`é€ä¿¡é–‹å§‹: ${urls.length} ä»¶ã®Webhook`);

  await Promise.all(urls.map(async (url, i) => {
    try {
      const res = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (res.ok) {
        log(`[æˆåŠŸ] (${i + 1}) ${url}`);
      } else {
        log(`[å¤±æ•—] (${i + 1}) ${url} - ${res.status} ${res.statusText}`);
      }
    } catch (e) {
      log(`[ã‚¨ãƒ©ãƒ¼] (${i + 1}) ${url} - ${e.message}`);
    }
  }));

  log('é€ä¿¡å‡¦ç†çµ‚äº†');
  return true;
}

startBtn.onclick = () => {
  if (timerId !== null) {
    alert('ã™ã§ã«å®šæœŸé€ä¿¡ä¸­ã§ã™');
    return;
  }
  const interval = parseInt(intervalInput.value, 10);
  if (isNaN(interval) || interval < 1) {
    alert('é€ä¿¡é–“éš”ã¯1ç§’ä»¥ä¸Šã®æ•°å­—ã§æŒ‡å®šã—ã¦ãã ã•ã„');
    return;
  }
  sendMessages(); // å³æ™‚é€ä¿¡ã‚‚OK
  timerId = setInterval(sendMessages, interval * 1000);
  log(`å®šæœŸé€ä¿¡ã‚’é–‹å§‹ã—ã¾ã—ãŸï¼ˆ${interval}ç§’æ¯ï¼‰`);
  startBtn.disabled = true;
  stopBtn.disabled = false;
  sendOnceBtn.disabled = true;
};

stopBtn.onclick = () => {
  if (timerId === null) {
    alert('å®šæœŸé€ä¿¡ã¯é–‹å§‹ã•ã‚Œã¦ã„ã¾ã›ã‚“');
    return;
  }
  clearInterval(timerId);
  timerId = null;
  log('å®šæœŸé€ä¿¡ã‚’åœæ­¢ã—ã¾ã—ãŸ');
  startBtn.disabled = false;
  stopBtn.disabled = true;
  sendOnceBtn.disabled = false;
};

sendOnceBtn.onclick = () => {
  sendMessages();
};
</script>
</body>
</html>
