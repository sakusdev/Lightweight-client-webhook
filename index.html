<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Discord Webhook è¤‡æ•°é€ä¿¡ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f1f3f5;
    }
    input, button, textarea {
      margin: 5px 0;
      padding: 8px;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      width: 49%;
    }
    #status {
      margin-top: 10px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>ğŸ’¬ Discord Webhook è¤‡æ•°å¯¾å¿œé€ä¿¡ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</h1>

  <label>
    Webhook URLï¼ˆè¤‡æ•°ã¯ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰:
    <textarea id="webhookUrl" rows="3" placeholder="https://discord.com/api/webhooks/..."></textarea>
  </label>

  <label>
    ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹:
    <input type="text" id="message" value="ã“ã‚“ã«ã¡ã¯ã€Webhook!" />
  </label>

  <label>
    é€ä¿¡é–“éš”ï¼ˆç§’ï¼‰:
    <input type="number" id="interval" value="10" min="1" />
  </label>

  <div>
    <button onclick="start()">â–¶ å®šæœŸé€ä¿¡é–‹å§‹</button>
    <button onclick="stop()">â¹ åœæ­¢</button>
  </div>
  <div>
    <button onclick="sendOnce()">ğŸ“¤ ä¸€åº¦ã ã‘é€ä¿¡</button>
  </div>

  <p id="status">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: åœæ­¢ä¸­</p>

  <script>
    let timerId = null;

    function getWebhookUrls() {
      const raw = document.getElementById('webhookUrl').value;
      return raw.split(',').map(url => url.trim()).filter(url => url.startsWith("http"));
    }

    function getMessage() {
      return document.getElementById('message').value.trim();
    }

    function sendMessageToAll() {
      const urls = getWebhookUrls();
      const content = getMessage();
      if (!urls.length || !content) {
        alert("Webhook URLã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      urls.forEach(url => {
        fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ content })
        })
        .then(res => {
          if (!res.ok) {
            console.error(`é€ä¿¡å¤±æ•— (${url}): ${res.status}`);
            document.getElementById("status").textContent = `ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: é€ä¿¡å¤±æ•— (${res.status})`;
          }
        })
        .catch(err => {
          console.error(`é€ä¿¡ã‚¨ãƒ©ãƒ¼ (${url}):`, err);
          document.getElementById("status").textContent = "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ";
        });
      });

      const time = new Date().toLocaleTimeString();
      document.getElementById("status").textContent = `ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${urls.length} ä»¶é€ä¿¡ (${time})`;
    }

    function start() {
      if (timerId) {
        alert("ã™ã§ã«é€ä¿¡ä¸­ã§ã™ã€‚");
        return;
      }

      const intervalSec = parseInt(document.getElementById("interval").value, 10);
      if (isNaN(intervalSec) || intervalSec <= 0) {
        alert("é€ä¿¡é–“éš”ã¯1ä»¥ä¸Šã®æ•°å­—ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      sendMessageToAll(); // åˆå›é€ä¿¡
      timerId = setInterval(sendMessageToAll, intervalSec * 1000);
      document.getElementById("status").textContent = `ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: å®šæœŸé€ä¿¡ä¸­ï¼ˆ${intervalSec}ç§’ã”ã¨ï¼‰`;
    }

    function stop() {
      if (timerId) {
        clearInterval(timerId);
        timerId = null;
        document.getElementById("status").textContent = "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: åœæ­¢ä¸­";
      }
    }

    function sendOnce() {
      if (timerId) {
        alert("å®šæœŸé€ä¿¡ä¸­ã§ã™ã€‚ä¸€åº¦ã ã‘é€ä¿¡ã—ãŸã„å ´åˆã¯å…ˆã«åœæ­¢ã—ã¦ãã ã•ã„ã€‚");
        return;
      }
      sendMessageToAll();
    }
  </script>
</body>
</html>
